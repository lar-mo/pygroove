{% extends 'base.html' %}
{% block content %}
<div class="mb-8">
    <h2 class="text-4xl font-bold mb-6 bg-gradient-to-r from-vinyl-purple to-vinyl-teal bg-clip-text text-transparent">Artists</h2>
    
    <form method="get" class="flex gap-4 bg-gray-900 p-4 rounded-lg border border-gray-800" id="search-form">
        <input type="text" name="q" placeholder="Search artists..." value="{{ request.GET.q }}"
               class="flex-1 bg-gray-800 text-white px-4 py-2 rounded-lg border border-gray-700 focus:border-vinyl-purple focus:outline-none transition-colors">
        <button type="submit" 
                class="bg-gradient-to-r from-vinyl-purple to-vinyl-teal px-6 py-2 rounded-lg text-white font-bold hover:scale-105 transform transition-all">
            Search
        </button>
    </form>
</div>

<div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-6" id="artist-grid">
    {% include 'partials/artist_cards.html' %}
</div>

<div id="loading" style="display: none; text-align: center; padding: 20px;">Loading more artists...</div>

<script>
let page = 1;
let loading = false;
let hasMore = true;

// Infinite scroll
window.addEventListener('scroll', function() {
    if (loading || !hasMore) return;
    
    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
    const scrollHeight = document.documentElement.scrollHeight;
    const clientHeight = document.documentElement.clientHeight;
    
    if (scrollTop + clientHeight >= scrollHeight - 100) {
        loadMore();
    }
});

function loadMore() {
    loading = true;
    document.getElementById('loading').style.display = 'block';
    
    page++;
    const params = new URLSearchParams(window.location.search);
    params.set('page', page);
    
    fetch('/artists/ajax/?' + params.toString())
        .then(response => response.json())
        .then(data => {
            if (data.html.trim() === '') {
                hasMore = false;
            } else {
                document.getElementById('artist-grid').insertAdjacentHTML('beforeend', data.html);
            }
            loading = false;
            document.getElementById('loading').style.display = 'none';
        })
        .catch(error => {
            console.error('Error loading more artists:', error);
            loading = false;
            document.getElementById('loading').style.display = 'none';
        });
}
</script>
{% endblock %}
